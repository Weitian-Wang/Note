- [Introduction](#introduction)
  - [Grading](#grading)
  - [Lab \& Discussion Group](#lab--discussion-group)
- [Introduction to Computer Security](#introduction-to-computer-security)
  - [Definition of Security](#definition-of-security)
    - [Security Goals - C.I.A](#security-goals---cia)
    - [Other Security Topics - A.A.A](#other-security-topics---aaa)
    - [Security Principles](#security-principles)
  - [5 Important Implementations](#5-important-implementations)
    - [1. Confidentiality using symmetric encryption](#1-confidentiality-using-symmetric-encryption)
    - [2. Confidentiality using asymmetric encryption](#2-confidentiality-using-asymmetric-encryption)
    - [3. Message authentication using symmetric encryption](#3-message-authentication-using-symmetric-encryption)
    - [4. Message authentication using asymmetric encryption](#4-message-authentication-using-asymmetric-encryption)
    - [5. Uer using asymmetric encryption - digital certificate](#5-uer-using-asymmetric-encryption---digital-certificate)
  - [Authentication Technologies](#authentication-technologies)
    - [Password](#password)
      - [Storage of Passwords](#storage-of-passwords)
      - [Password Salt](#password-salt)
  - [Direct Attack](#direct-attack)
    - [Environmental Attacke](#environmental-attacke)
    - [Eavesdropping](#eavesdropping)
    - [Wiretapping](#wiretapping)
    - [Acoustic Emissions](#acoustic-emissions)
    - [Hardware Keylogger](#hardware-keylogger)
    - [TEMPEST](#tempest)
    - [Emanation Blockage](#emanation-blockage)
    - [ATMs](#atms)
      - [Magnetic Stripe Card](#magnetic-stripe-card)
      - [Chipped Card](#chipped-card)
    - [SIM Card](#sim-card)
    - [Biometrics](#biometrics)
- [Operating System \& File System Security](#operating-system--file-system-security)
  - [Operating System](#operating-system)
  - [File System](#file-system)
    - [File Permission](#file-permission)
    - [Bitlocker Encryption](#bitlocker-encryption)
      - [Basics](#basics)
      - [Decryption](#decryption)
      - [Update Key](#update-key)
    - [Encrypting File System](#encrypting-file-system)
      - [Basics](#basics-1)
      - [Encryption](#encryption)
      - [Decryption](#decryption-1)
  - [Process](#process)
  - [Memory](#memory)
    - [Memory Segments](#memory-segments)
- [Software \& Program Security](#software--program-security)
  - [Buffer Overflow](#buffer-overflow)
    - [Buffer](#buffer)
    - [Overflow Attack](#overflow-attack)
    - [Countermeasures](#countermeasures)
      - [ASLR - Address Space Layout Randomization](#aslr---address-space-layout-randomization)
      - [DEP - Data Execution Prevention](#dep---data-execution-prevention)
  - [Heart Bleed (Buffer Overread) - Memory Leak](#heart-bleed-buffer-overread---memory-leak)
  - [Command Injection](#command-injection)
    - [Command Injection vs Code Injection](#command-injection-vs-code-injection)
  - [Integer Overflow](#integer-overflow)
  - [File Access Race Condition - TOCTOU](#file-access-race-condition---toctou)
- [Malware](#malware)
  - [Catagories of Malware](#catagories-of-malware)
    - [According to Propagation](#according-to-propagation)
    - [According to Concealment](#according-to-concealment)
  - [Insider Attacks](#insider-attacks)
    - [Backdoors](#backdoors)
    - [Logic Bomb](#logic-bomb)
    - [Defenses](#defenses)
  - [Virus](#virus)
    - [Phases](#phases)
    - [Countermeasures](#countermeasures-1)
      - [Signature](#signature)
      - [Heuristic](#heuristic)
        - [Code Analysis](#code-analysis)
        - [Execution Emulation](#execution-emulation)
      - [Static Analysis \& Dynamic Analysis](#static-analysis--dynamic-analysis)
    - [Concealment](#concealment)
      - [Encrypted Virus](#encrypted-virus)
        - [Characteristics](#characteristics)
        - [Detection](#detection)
      - [Polymorphic Virus](#polymorphic-virus)
        - [Characteristics](#characteristics-1)
        - [Detection](#detection-1)
      - [Metamorphic Virus](#metamorphic-virus)
        - [Characteristics](#characteristics-2)
        - [Detection](#detection-2)
  - [Worm](#worm)
- [Network Security](#network-security)
  - [Network Basics](#network-basics)
    - [5 Layer Network Model](#5-layer-network-model)
      - [Physical Layer](#physical-layer)
      - [Data Link Layer](#data-link-layer)
      - [Network Layer](#network-layer)
      - [Transport Layer](#transport-layer)
      - [Application Layer](#application-layer)
  - [Solve IPv4 Address Shortage - NAT](#solve-ipv4-address-shortage---nat)
  - [Network Attacks](#network-attacks)
    - [ARP Spoofing \& Poisoning](#arp-spoofing--poisoning)
      - [ARP Basics](#arp-basics)
      - [ARP Vulnerability](#arp-vulnerability)
    - [ICMP Attack](#icmp-attack)
      - [ICMP Basics](#icmp-basics)
      - [ICMP Vulnerability](#icmp-vulnerability)
        - [Ping of Death](#ping-of-death)
        - [Smurf Attack](#smurf-attack)
    - [IP Vulnerabilies](#ip-vulnerabilies)
    - [Denial of Service Attack](#denial-of-service-attack)
    - [SYN Flood](#syn-flood)
    - [Session Hijacking](#session-hijacking)
    - [IP Spoofing](#ip-spoofing)
    - [Packet Sniffer](#packet-sniffer)
    - [DNS Attacks](#dns-attacks)
      - [DNS Basics](#dns-basics)
      - [DNS Posioning](#dns-posioning)
  - [Transport Layer Security / Secure Socket Layer (TLS/SSL)](#transport-layer-security--secure-socket-layer-tlsssl)
  - [Virtual Private Network](#virtual-private-network)
    - [IP Tunneling](#ip-tunneling)
      - [IPSec Tunneling](#ipsec-tunneling)
      - [TLS/SSL Tunneling](#tlsssl-tunneling)
- [Symmetric Encryption](#symmetric-encryption)
  - [Terminologies](#terminologies)
  - [Classic](#classic)
    - [Substitution](#substitution)
    - [Permutation](#permutation)
    - [Vulnerability](#vulnerability)
  - [Mordern](#mordern)
    - [Advanced Encryption Standard](#advanced-encryption-standard)
      - [Substitution-Permutation Network](#substitution-permutation-network)
      - [Specifications](#specifications)
      - [AES Structure](#aes-structure)
      - [1. Substitute Bytes](#1-substitute-bytes)
      - [2. Shift Rows](#2-shift-rows)
      - [3. Mix Columns](#3-mix-columns)
        - [Matrix Multiplication - Multiply](#matrix-multiplication---multiply)
        - [Matrix Multiplication - Add](#matrix-multiplication---add)
      - [4. XOR Round Key](#4-xor-round-key)
    - [Mathematics of ASE](#mathematics-of-ase)
      - [XOR Inverse Property](#xor-inverse-property)
      - [Set and Field](#set-and-field)
      - [Identity](#identity)
        - [Additive Identity](#additive-identity)
        - [Multiplicative Identity](#multiplicative-identity)
      - [Inverse](#inverse)
        - [Additive Inverse](#additive-inverse)
        - [Multiplicative Inverse](#multiplicative-inverse)
      - [Modulo Arithmetic](#modulo-arithmetic)
      - [Finite Field](#finite-field)
      - [Galois Field](#galois-field)
        - [Primitive Galois Field](#primitive-galois-field)
        - [Extension Galois Field](#extension-galois-field)
          - [Special Galois Field $gf(2^n)$](#special-galois-field-gf2n)
          - [Addition](#addition)
          - [Modulo Reduction](#modulo-reduction)
- [Asymmetric Encryption](#asymmetric-encryption)
  - [Applications](#applications)
  - [RSA](#rsa)
    - [Key Generation](#key-generation)
    - [RSA Encryption and Decryption](#rsa-encryption-and-decryption)
      - [Encryption with Public Key](#encryption-with-public-key)
      - [Decryption with Private Key](#decryption-with-private-key)
    - [Mathematics for RSA](#mathematics-for-rsa)
      - [Division](#division)
      - [Euclid's Algorithm - GCD](#euclids-algorithm---gcd)
      - [Bizout's Identity](#bizouts-identity)
      - [Application of Euclid and Bizout in RSA](#application-of-euclid-and-bizout-in-rsa)
      - [Euler Totient Function](#euler-totient-function)
      - [Fermat's Little Theorem](#fermats-little-theorem)
      - [Euler's Theorem](#eulers-theorem)
      - [Implement Theorem in RSA](#implement-theorem-in-rsa)
- [Final Review](#final-review)
  - [ICE4 RSA part:](#ice4-rsa-part)
  - [ICE3 AES part:](#ice3-aes-part)
  - [ICE2 Network Security](#ice2-network-security)
  - [ICE1 Symmetric \& Asymmetric Cryptosystem](#ice1-symmetric--asymmetric-cryptosystem)

# Introduction
## Grading
10 Weeks, 4 Lab, 4 HW
1. 30% Homework
2. 30% Lab
3. 30% Final Exam
4. 10% Class - Class study case will appear in final!
## Lab & Discussion Group
Groups 75, Ismat Jarin, 1st Year PhD student (Security), ijarin@uci.edu

# Introduction to Computer Security
## Definition of Security
> Memorize the case study instead of the plain definition of concept.  

Security of system, application, or protocol is **related** to  
* A set of desired properties - Security Goals
* An adversary with specific capabilities - Threads and Attacks  
### Security Goals - C.I.A
* Confidentiality - avoidance of unauthorized disclosure of info
    1. Encryption
    2. Access Control
    3. Authentication  
    Determin the identity of someone.
    4. Authorization  
    Determin the user's access to resources.  
        > Study case: Student, professor, TA see different pages after login canvas with UCI NetID.  

    1. Physical Security
* Integrity - avoidance of unauthorized info alteration
    1. Backups
    2. Check Sum
    3. Data Correction Codes
* Availability - info is accessable to authorized personal  
    1. Physical Protection
    2. Computational Redundancies
> Study case:  
> Confidentiality: Russia gets data from Ukraine military.
> Integrity: Change nuclear power plant sensors' data sent to control center.  
> Availability: Viasat terminals in Europe rendered inoperable as modems were attacked.  


### Other Security Topics - A.A.A
* Assurance
* Authenticity
* Anonymity

### Security Principles
Ideas that make a system safer.  


## 5 Important Implementations
> Notations:  
> M - Message - Plain message  
> C - Cipher - Encrypted message  
> E[] - Encrypt function  
> D[] - Decrypt function  
> H - Hash value after Hash[] function  
> P - Public Key  
> S - Secret Key (symmetric or asymmetric)  
> i.e. $C = E_{P_A}[M]$ means **E**ncrypt **M**essage with user **A**'s **P**ublic key to get **C**ipher.  
> When denoting secret key in symmetric cryptography system, use subsript of both side $S_{AB}$  

### 1. Confidentiality using symmetric encryption 
Sender A and Receiver B shares secret key $S_{AB}$. As long as secret key is not compromised, the confidentiality of communication is ensured.    
Sender A Encrypts message M with secret key $C=E_{S_{AB}}[M]$  
Send Cipher C to Reciver B  
Receiver B Decrypts cipher with secret key $M=D_{S_{AB}}[C]$  
### 2. Confidentiality using asymmetric encryption  
Sender A has Public Key $Pu_{A}$ and Private Key $Pr_{A}$.  
Reciver B has Public Key $Pu_{B}$ and Private Key $Pr_{B}$.  
Public key is shared with all communication parties.  
Sender A Encrypts message M with B's Public Key $C=E_{Pu_{B}}[M]$  
Send Cipher C to Reciver B    
Reciver B Decrypts cipher with its private key $M=D_{Pr_{B}}[C]$  
### 3. Message authentication using symmetric encryption  
> Authentication ensures message integrity and authenticity.  
> Unless secret key is leaked, the man in the middle won't be able to change both orginal message and hash.  

Sender A generate Hash of message $H=Hash[M]$  
Sender A encrypt the hash with secret key $C=E_{S_{AB}}[Hash[M]]=E_{S_{AB}}[H]$  
Send original message M with encrypted hash $M||C$  
Receiver B calculates own hash of message $H'=Hash[M]$  
Receiver B decrypts cipher with secret key to get sender's message hash $D'=D_{S_{AB}}[C]$  
Compare $H'$ with $D'$
### 4. Message authentication using asymmetric encryption
Sender A generate Hash of message $H=Hash[M]$  
Sender A encrypt the hash with **its private key** $C=E_{Pr_{A}}[Hash[M]]=E_{Pr_{A}}[H]$  
Send original message M with encrypted hash $M||C$  
Receiver B calculates own hash of message $H'=Hash[M]$  
Receiver B decrypts cipher with sender's public key to get sender's message hash $D'=D_{Pu_{A}}[C]$  
Compare $H'$ with $D'$  
> Public key is accessible to everyone encluding attacker. To ensure the man in the middle can't generate the same authentication message, we use private key to encrypt the hash.  

### 5. Uer using asymmetric encryption - digital certificate  
CA - Certificate Agency is a entrusted third party, has $Pu_{CA}$ and $Pr_{CA}$  
The digitial certificate of A:  
The **hash** of A's **public key** signed by CA's **private key** $E_{Pr_{CA}}[Hash[Pu_{A}]]$  
For communiction party B, when it acquires A's public key and want to certify the authenticity of that, B decrypts the certificate with CA's public key and get the hash of authentic $Pu_{A}$. Compare the hash to certify A's public key. $H=D_{Pu_{CA}}[Cert_A]$  
> If CA's private key is compromised, attacker can sign certificate for malicious parties' public keys.  

## Authentication Technologies
Authentication is the determination of identity, which is base on:
1. something the person knows (password)
2. something the person has (keycard, physical storage of secret keys)
3. something the person is (biological fingerprints or iris)
### Password
#### Storage of Passwords
Store password hash instead of original plaintext password. This prevents the acquisition of password even if attacker gets hold of database.  
#### Password Salt
To prevent dictionary attack on the password database, password salt can be added when hashing the password.  
A cryptographic salt is made up of **random bits** added to each password instance **before** its hashing. Salts create unique passwords even in the instance of two users choosing the same passwords. Salts help us mitigate hash table (dictionary) attacks by forcing attackers to re-compute them using the salts for each user.  
To mitigate the damage that a hash table or a dictionary attack could do, we salt the passwords. Salt is a value generated by a cryptographically secure function that is added to the input of hash functions to create unique hashes for every input, regardless of the input not being unique. A salt makes a hash function look non-deterministic, which is good as we don't want to reveal duplicate passwords through our hashing.  
Let’s say that we have the password farm1990M0O and the salt f1nd1ngn3m0. We can salt that password by either appending or prepending the salt to it. For example, farm1990M0Of1nd1ngn3m0 or f1nd1ngn3m0farm1990M0O are valid salted passwords. Once the salt is added, we can then hash it.  

## Direct Attack
### Environmental Attacke
1. Electricity 
2. Temperture
3. Limited Conductance - Short circuit by flood

### Eavesdropping
### Wiretapping
### Acoustic Emissions
### Hardware Keylogger
### TEMPEST
Levels:
1. Direct contact
2. 20 meters
3. 100 meters
### Emanation Blockage
Block the visible light, acoustic and electromagnetic emanation. 
### ATMs
#### Magnetic Stripe Card
Skimmer can read card data and make replica.
#### Chipped Card
Smart cards incorporate a circuit, allowing the reading and writing of the card data. This enables secure authentication for the cards.
### SIM Card
Subscriber Identity Module Card.
### Biometrics
- Fingerprints
- Retinal/iris scans
- DNA
- Voice recognition
- Face recognition
- Gait recognition

# Operating System & File System Security
Every component can be attacked. Same for the network. Study the components first then possible vulnerabilities.
## Operating System
The security of operating system should be built in
1. The construction of OS
2. The installation of OS
3. Secure booting process
4. Security of additional device
5. Keep OS up to date with all known security problem patched
## File System
File system is the abstraction of how external storage of computer is managed.
### File Permission
- Read: This permission give you the authority to open and read a file. Read permission on a directory gives you the ability to list its content.
- Write: The write permission gives you the authority to modify the contents of a file. The write permission on a directory gives you the authority to add, remove and rename files stored in the directory. Consider a scenario where you have to write permission on a file but do not have write permission on the directory where the file is stored. You will be able to modify the file contents. But you will not be able to rename, move or remove the file from the directory.
- Execute: In Windows, an executable program usually has an extension “.exe” that you can quickly run. In Unix/Linux, you cannot run a program unless the execute permission is set. If the execute permission is not set, you might still be able to see/modify the program code(provided read & write permissions are set), but not run it.  

r = read permission  
w = write permission  
x = execute permission  
– = no permission  
User Group Others  
rwxr-xr-x
```sh
chmod 755 filename
chmod u+r filename
chmod u=rwx filename
```
### Bitlocker Encryption
#### Basics
```
                                   ┌────────┐
┌─────┐    ┌─────┐    ┌──────┐     │        │
│ SRK ├───►│ VEK ├───►│ FVEK ├────►│  Disk  │
└─────┘    └─────┘    └──────┘     │        │
                                   └────────┘
```
> SRK: Storage Root Key stored in Trusted Platform Module (TPM)  
> VEK: Volume Encryption Key, encrypted by SRK and stored in disk  
> FVEK: Full Volume Encryption Key, encrypted by VEK and stored in disk  
> Disk: Encrypt/decrypt disk data with FVEK, computaionally heavy task  
#### Decryption
1. Get encrypted VEK from disk, decrypt with SRK  
2. Get encrypted FVEK from disk, decrypt with VEK  
3. Get encrypted file/volume from disk, decrypt with FVEK
#### Update Key
If only one key is used to encrypt data, the update of key requires:
1. The decryption of entire hard disk with old key
2. Generate new key
3. Encrypt entire hard disk with new key  
The decryption and encryption of the entire disk is computationally expensive

If we use three level volume encryption key, we only need to update middle key:
1. Get encrypted VEK from disk, decryt with SRK
2. Get encrypted FVEK from disk, decrypt with VEK
3. Generate new VEK
4. Encrypt FVEK with VEK, store new encryption in disk
5. Encrypt VEK with SRK, store new encryption in disk
### Encrypting File System
#### Basics
User have public key and private key of RSA asymmetric cryptosystem. User can also generate symmetric File Encryption Key (FEK). 
#### Encryption
1. Dynamically generate File Encryption Key for each encryption.
2. Encrypt file with FEK.
3. Encrypt FEK with user public key.
4. Put encrypted FEK in the header of encrypted file.
#### Decryption
1. Extract encrypted FEK from encrypted file header.
2. Decrypt FEK with user private key.
3. Decrypt file with FEK.
## Process
Instance of executing program. Instrucions must be load into RAM to execute.
## Memory
DRAM is the address space of compuet. Memory contains both data and instruction for the Von Neumann architecture.
> Review Lab1 stack overflow for this section.  

### Memory Segments
The misuse of segments can cause security concerns.
1. Text
2. Data
3. BSS
4. Heap
5. Stack


# Software & Program Security
## Buffer Overflow
### Buffer
Buffer is the portion of memory alloced to arrays. Buffer is in the stack segment of memory.
### Overflow Attack
Buffer overflow occurs when copying data into memory without length check. The progrm will write data into memory exceeding the array bound, causing unauthorized writing of memory.
> Review Lab1  

### Countermeasures
#### ASLR - Address Space Layout Randomization
ASLR prevents the attacker from reliably jumping to malicious function in memory. This countermeasure randomizes the address space position of the process, including stack, heap and libraries. ASLR became a hurdle for attacks who try to guess and hardwire the target injection address with the overflow attack.
#### DEP - Data Execution Prevention
Data Execution Prevention marks certain vulnerable parts as non-executable, to prevent the execution of malicious instructions.
## Heart Bleed (Buffer Overread) - Memory Leak
Vitim software OpenSSL use non-sanitized user input length parameter. The length parameter is then passed to memcpy() without length check. The victim software will allocate a 64KB buffer, then copy more bytes than is necessary from memory to the buffer and send the buffer back. Therefore the memory contents are leaked to attacker 64KB at a time.
## Command Injection
Command Injection is a type of cyber attack that seeks to execute shell commands via a vulnerable application. This type of attack is possible when an application passes user supplied data to the system shell. (i.e. cookies, forms, HTTP Headers)
### Command Injection vs Code Injection
Command injection passes untrusted user input to the system shell.  
Code injection inject malicious code into vulnerable program. i.e SQL Injection.  
## Integer Overflow
Also known as wraparound errors. If integer exceeds the type maximum of minimum, attacker can exploit this to get around condition check of that integer. 
## File Access Race Condition - TOCTOU
Time-of-check, time-of-use.  
TOCTOU occurs when two or more processes concurrently access a shared file system.  
The victim program performing multiple operations (accesses and opens in the following exmple) on a single file will eventually create a race condition between two operations.  
The race condition exploitable because an attacker can alter the file between the two operations and replace the file completely to gain elevated privilege.    
Victim  
```c
// check if user running this program have access to file
// access() open() operate on filename instead of handle
if (access("file", W_OK) != 0) {
    exit(1);
}
// attacker link "file" to a different file /etc/passwd
fd = open("file", O_WRONLY);
// Actually writing over /etc/passwd
write(fd, buffer, sizeof(buffer));
// run this block over and over again will incur rece condition
```
Attacker
```c
// After the access check
symlink("/etc/passwd", "file");
// Before the open, "file" points to the password database
```

# Malware 
Maliciou software.
## Catagories of Malware
Malwares can be classified into several catagories based on different characteristics.
### According to Propagation
- Virus: human assisted propagation, triggered by host action
- Worm: automatic propagation, self replicate
### According to Concealment
- Rootkit: modifies OS to hide its existence
- Trojan: provides desirable functionality but hides malicious operation
## Insider Attacks
Security breach caused by someone who is part of the organization that builds the asset that should be protected.
### Backdoors
Hidden feature or command that allow user to perform unallowed actions.
### Logic Bomb
A program performs malicious action when certain logic conditions occur.
### Defenses
1. Avoid single point of failure
2. Code walk-throughs
3. Limit authority and permission
4. etc.

## Virus
virus is computer code that replicate itself, by modifying other files or programs to insert code that can further replicate the virus itself. The replication of virus requires use assistance (click link, insert USB drive). 

### Phases
1. Dormant Phase
2. Propagation Phase
3. Triggering Phase
4. Action Phase

### Countermeasures
Analyse known virus, then search for similar signatures and heuristics of code in user's computer. If the code is re-encrypted the antivirus tool will fail to recognize the virus.
#### Signature
A signature is a virus fingerprint, e.g a sequence of instruction specific for each virus. Use pattern matching techniques to search for signatures in a known virus signature database.
#### Heuristic
Heuristic anaylsis is useful againt new malware. 
##### Code Analysis
Check if program have suspecious instructions like delete system files.
##### Execution Emulation
Run code in isolated emulation environment and monitor harmful actions.  
#### Static Analysis & Dynamic Analysis
Static analysis checks the code without executing it.  
Dynamic analysis evaluates the execution of codes, usually in a sandbox. 
### Concealment 
#### Encrypted Virus
##### Characteristics
The virus body is encrypted, which may get around detection. The virus package comes with a decryption engine.
##### Detection
Detection of encrypted virus looks for decryption engine.
#### Polymorphic Virus
##### Characteristics
Based on encrypted virus. The mutation engine creates a new decryption routine to make it appear different each time.
##### Detection
Although name, size and location might change for each virus copy, the function and goal of the virus ramains the same. Detection using CPU emulator.
#### Metamorphic Virus
##### Characteristics
Metamorphic virus rewrites itself at each iteration. The virus body become different, using code permutation and instruction replacement.
##### Detection
Challenging to detect.
## Worm
# Network Security
## Network Basics
### 5 Layer Network Model
#### Physical Layer
Zeros and ones.  
Transmission of bits. Protocol physical property agreements about wires and interfaces.
#### Data Link Layer
Frames send according to MAC addresses.  
Delivers data frame within a local network. Protocols: Ethernet, Wireless Ethernet.
#### Network Layer
Packets send according to IP addresses.  
Deliver packets between hosts, work cross different networks. Protocol: IPv4, Address Resolution Protocol, Internet Control Message Protocol, Dynamic Host Configuration Protocol.  
ARP: Asking for or telling others the mapping between MAC and IP
ping command: ICMP  
#### Transport Layer
Port number on top of IP addresses.  
Delivers data from a process one host to a process on another host. Host assign port number to process. Protocol: TCP, UDP.
#### Application Layer
Protocol: Domain Name System, HTTP, HTTPS, SSH, FTP  
## Solve IPv4 Address Shortage - NAT
NAT stands for Netword Address Translation. NAT translate one IP address to another. With port translation, NAT allows multiple host to use a single public IP address.
## Network Attacks
### ARP Spoofing & Poisoning
#### ARP Basics
ARP - Address Resolution Protocol is the protocol that connects datalink layer with network layer, as it translates between MAC address and IP address.  
ARP broadcast requests asking for MAC address of a given IP address. 
who has xxx.xxx.xxx.xxx tell xxx.xxx.xxx.xxx  
The machine knows the MAC of target IP receives the request and broadcast a response.  
xxx.xxx.xxx.xxx is MAX_ADDRESS  
#### ARP Vulnerability
As ARP requests are neither tracked nor authenticated, a rogue machine can spoof other machines and respond ARP requests with faulty responses. The sender will trust this malicious response and update its ARP table. Lab 2 task 1.4
### ICMP Attack
#### ICMP Basics
ICMP - Internet Control Message Protocol is used for network testing and debugging.   
Applications of ICMP: Ping & Traceroute.  
#### ICMP Vulnerability
##### Ping of Death
Use IP fragmentation to exceed ICMP packet size limitation, reassembled packet can crash the system with buffer overflow.
##### Smurf Attack
Smurf attack is a form of Distributed Denial of Service(DDoS) attack.  
Attacker send ICMP packets to the broadcast address of a network, using victim's IP as source (Spoofing). The nodes will send back replies to the victim which overwhelm the victim network.
### IP Vulnerabilies
1. Unencrypted transmission - Eavesdropping is possible at any routing process
2. No source authentication - IP address can be spoofed, bad accountability
3. No integrity check - MITM Man in the middle attack can modify the content of packets
4. No bandwidth constraints - Large number of packets can be injected into a network, denial of service attack
### Denial of Service Attack
Attacker uses zombie network or botnet, to send large number of packets to service provider host and slow down or crash the host. Attacker can spoof the source of IP to hide themself.  
### SYN Flood
SYN is the TCP connection request, to which the receiver must response. SYN flood creates a large number of SYN requests with spoofed source IP address. The server responses with SYN/ACK but never gets a follow up. Eventually the service providing host stops accepting connection requests, thus triggering a denial of service.
### Session Hijacking
TCP session hijacking attempts to take control of TCP/IP sessions. The attacker has to guess the ack sequence number.
### IP Spoofing
Send packets (with malicious intentions) from one IP address that is not the true origin IP.
### Packet Sniffer
Packet sniffer intercepts network packets. This action needs root privilege as the sniffer requires access to network interface cards.  
Can be used as legitimate tools to analyze a network  
- Monitor network usage
- Filter network traffic
- Analyze network problems  

Can also be used maliciously  
- Steal information (i.e. passwords, conversations, etc.)
- Analyze network information to prepare an attack  

### DNS Attacks
#### DNS Basics
DNS - Domain Name System is a application layer protocol for mapping domain names to IP addresses.
#### DNS Posioning
Attacker feed DNS server false records and DNS server caches them.
## Transport Layer Security / Secure Socket Layer (TLS/SSL)
[The 5 Important Implementations](#5-important-implementations) can be applied to application layer. We can provide addtional transport layer security. TLS is evolved from SSL.  
These security measures can be adopted by client and server, with application security on top of them.
## Virtual Private Network
Virtual Private Network - VPN allows users to create secure private network over a public network (the Internet). VPN server is required to connect outside computers to inside host. It also protects internal computers.
### IP Tunneling
Tunnel transmits private network packets in the public network. The packets sent in tunnels encapsulates a IP packet, the inner IP packet is protected packets to/from private networks.
#### IPSec Tunneling
Utilizes the tunneling mode of Internet Protocol Security (IPSec) protocol. Encapsulate the private network IP packet in a new IP packet.
#### TLS/SSL Tunneling
Tunneling done outside kernel at the application level. Encapsulate the private network IP packet in TCP/UDP payloads, then secure TCP/UDP packets with TLS/SSL protocol.
# Symmetric Encryption
Confidentiality can be reinforced with encrypion.
## Terminologies
- plaintext - original message 
- ciphertext – hidden/coded message 
- cipher (encryption)- algorithm for transforming plaintext to ciphertext
- encipher (encrypt) - converting plaintext to ciphertext
- decipher (decrypt) - recovering plaintext from ciphertext
- key - info used in cipher known only to sender/receiver 
- cryptography - study of encryption principles/methods
- cryptanalysis - deciphering the ciphertext without knowing the key
## Classic
Based on either permutation or substitution.
### Substitution
Letters of plaintext replaced by other letters.
### Permutation
Change order of letters of plaintext.
### Vulnerability
The classic cipher is susceptible to cryptanalysis like frequency analysis.
## Mordern
Combination of permutation, substitution and more.
### Advanced Encryption Standard
AES - Advanced Encryption Standard is modern block cipher. Block cipher means AES works on fixed-length groups of bits called blocks.
#### Substitution-Permutation Network
S-P network is based on repetive substitution and permutation(transposition). 
#### Specifications
Key length of AES can vary from 128/192/256 bits. Key regardless of size is used to generate 128-bits round key.  
Size of input block 128 bits = 128/8 = 16 Bytes = 16 ASCII Characters = 16 Two Digit Hexadecimal Numbers.  
The input is ordered in a 4 by 4 matrix, in a top-down, left to right order.  
```
Plaintext: A, B, C, ..., P
Input Block:
A E I M         41  45  49  4D                 
B F J N         42  46  4A  4E
C G K O         43  47  4B  4F
D H L P         44  48  4C  50
```
#### AES Structure
AES has multiple rounds, each round has following process:  
1. Byte substitution according to S-box. 1 Byte entry used on every byte.
2. Shift rows
3. Mix columns
4. Add(XOR) round key  

> These operations are **SEQUENTIAL**.  

The decryption process is the strict **inverts** of the encryption process.
#### 1. Substitute Bytes
For each byte, which equals to 2 digit hexadecimal number, use the first digit (4 bytes) to find row index and second digit to locate column index.
#### 2. Shift Rows
1st row unchanged  
2nd row 1 byte circular shift to left  
3nd row 2 byte circular shift to left  
4nd row 3 byte circular shift to left  
#### 3. Mix Columns
Mix column is achieved by multiplying result of shift rows with Mix Column Matrix.  
```
Matrix for Mix Column
02 03 01 01
01 02 03 01
01 01 02 03
03 01 01 02
```
##### Matrix Multiplication - Multiply
Multiply by 01 - result remains same  
Multiply by 02 - in binary mult by 2 is equivalent to left by one. if most significant bit is 1 before shift, result must XOR 0x1B.  
Multiply by 03 - equals multiply by 02 then add input again
##### Matrix Multiplication - Add
Addition is XOR
#### 4. XOR Round Key
XOR mix column result with round key. Round key generation is ingored for this course. Longer the original key, more rounds of encryption.  

### Mathematics of ASE
#### XOR Inverse Property
Get cipher by XOR input with key. We can invert cipher back to plaintext by XOR cipher with key.  
#### Set and Field
A set only consists of elements. $Z_8 = \{1,2,3,\dots, 7\}$  
Field is a set combined with addition and multiplication.
#### Identity
##### Additive Identity
A number ($0$) in the set which doesn't change the value of a given number when added to it.
$$a + 0 = a$$
##### Multiplicative Identity
A number ($1$) in the set which doesn't change the value of a given number when multiplied to it.
$$a \times 1 = a$$
#### Inverse
##### Additive Inverse
A number ($-a$) in the set which produces **additive identity value(0)** when added to a given number.
$$a + (-a) = 0$$
##### Multiplicative Inverse
A number ($\text{a}^{-1}$) in the set which produces **multiplicative identity value(1)** when multiplied to a given number. An integer has a multiplicative inverse in $Z_n$ if that integer is relatively prime to n.  
$$a \times a^{-1} = 1$$
#### Modulo Arithmetic
$$a\ mod\ n\ =\ b,\ \  0<=b<=n-1$$
$$a = q\times n + b$$
n modulus  
b residue  
#### Finite Field
A field is called a finite field if the set F is finite.  
$Z_p=\{0,1,2,\dots,p-1\}$, we define + and ⋅ as addition modulo p and multiplication modulo p 
#### Galois Field
For every prime power $p^n, n = 1,2,\dots$, there is a unique finite field containing $p^n$ elements, denoted by $gf(p^n)$ or Galois Field.
##### Primitive Galois Field
Primitive Galois Field is where n = 1, $gf(p^1) = gf(p)$, where arithmetic is done modulo p.  
$gf(2) = \{0,1\}$ add mult modulo 2  
$gf(3) = \{0,1,2\}$ add mult modulo 2  
##### Extension Galois Field
Extension Galois Field is Galois Field where n is greater than 1. AES uses $gf(2^8)$.  
Extension field uses polynomials as elements. An element from $gf(p^n)$ can be represented as polynomial $A(x)$, with highest degree of $n-1$ and coefficiency in $gf(p)=\{0,1,\dots,p-1\}$.  
modulo reduction (fixed irreducible polynomial as modulus) for multiplication, XOR for addition.  
###### Special Galois Field $gf(2^n)$
The highest degree of n-1 and coefficiency in $\{0,1\}$.  
E.g $gf(2^2)$ has four elements $\{0,1,2,3\}=\{00,01,10,11\}={0,1,x,x+1}$  
###### Addition
Adding polynomials requires addition (XOR) of coefficiency.  
For $gf(2^n)$, coefficiency of polynomial element is either 0 or 1.  
```
In mod 2 addition
0+0=0
1+0=1
0+1=1
1+1=0
This is why we can use XOR to achieve mod 2 addition.
```
###### Modulo Reduction
The irreducible polynomial as modulus, calculate the residue.  
Calculate A(x) mod B(x), divide A(x) by B(x), use XOR as minus.


# Asymmetric Encryption
Asymmetric encryption uses different keys for encryption and decryption. The public key cryptography complements symmetric cryptography. The public key can be shared without a secure channel.
## Applications
1. Encryption and Decryption - Confidentiablity
2. Digital Signature - Authenticity
3. Key Exchange - Share session key in insecure channnel  

## RSA
By Rivest, Shamir & Adleman of MIT in 1977.  
RSA uses exponentiation of integers modulo a prime. Exponentiation is repeated multiplication.   
### Key Generation
Step 1  
Select prime number p and q, p != q, which means p and q are also coprime.  

Step 2  
Calculate $n = p \times q$  
Calculate $\phi(n)=(p-1)\times (q-1)$  

Step 3  
Select integer e, so that $gcd(\phi(n),e)=1$ and $1<e<\phi(n)$  
> gcd(a,b) = 1 also means a and b are coprime  

Step 4
Calculate d, so that $de\ mod\ \phi(n) = 1$  

Step 5  
Public Key = {e, n}  
Private Key = {d, n}  

### RSA Encryption and Decryption
#### Encryption with Public Key
Plain text m < n (smaller bit size for binary)  
$C = M^e(mod\ n)$  
#### Decryption with Private Key
$M = C^d(mod\ n)$  

### Mathematics for RSA
#### Division
$a = qn + r$ where $0<=r<n$  
Divide a by n get quotient q and residual r.  
E.g.  
a = -4, n = 11, $a=(-1)\times n+7$, residual 7
#### Euclid's Algorithm - GCD
Euclid's |ˈjuːklɪd| Algorithm is the algorithm for finding the greatest common divisor of two numbers.  
m = n (q1)  + r1  
n  = r1 (q2) + r2  
r1 = r2 (q3) + r3  
r2 = r3 (q4) + r4  
...  
rn-3 = rn-2 (qn-1) + rn-1  
rn-2 = rn-1 (qn) + rn gcd  
rn-1 = rn (qn+1) + 0  

#### Bizout's Identity
Bizout? Bézout? Extension of Euclid's Algorithm.  
For positive integer m and n, gcd(m, n) is the **smallest** **positive** element of the set  
$$\{am+bn:\ a,b in Z=\{\dots,-2,-1,0,1,2,\dots \}\}$$  
#### Application of Euclid and Bizout in RSA
We can usd Euclid's algorithm in reverse to get modulo inverse, the process of known e and calculate d.
> Recall:  
> Multiplicative Identity - a number (1) in the set when multiplied to gets the same value as input.  
> Multiplicative Inverse - a number in the set when multiplied to gets identity (1).  
> The same rule for finding multiplicative inverse of a mod b, under mod b set.


#### Euler Totient Function
Euler |ˈɔɪlə| Totient Function $\phi(n)$ = The **number of elements** in reduced set of residues.
The result set of residues mod n is $\{0,1,2,\dots,n-1\}$.  
The reduced set of residues is the subset of numbers in $\{0,1,2,\dots,n-1\}$ thats relatively prime to n.  
Special case:  
For p prime $\phi(p)=p-1$  
> mod p residue set {0,1,2,...,p-1}, reduced residue set = {1,2,...,p-1}  
> 1 is coprime to any number, 0 is not coprime with any number  

And for p, q both prime, $\phi(p\times q) = (p-1)(q-1)$  
> RSA choose non-equal prime p and q, to exploit this property.  


#### Fermat's Little Theorem
$$a^{p-1}\ =\ 1(mod\ p)$$
> (mod p) means modulo p on **both sides** of the equation.  

Where p is prime and gcd(a,p)=1, a and p are coprime.
#### Euler's Theorem
Euler's Theorem is generaization of Fermat's Little Theorem.  
$$a^{\phi(n)}\ =\ 1(mod\ n)$$
For **any** a and n where gcd(a,n)=1, a and n are coprime.
#### Implement Theorem in RSA
Given $de\ mod\ \phi(n)=1$ we get $de = k\times\phi(n)+1$  
and Euler's theorem $a^{\phi(n)}\ =\ 1(mod\ n)$ for coprime a and n.  
$$C^d = (M^e)^d = M^{ed} = M^{k\times\phi(n)+1} = M\times (M^{\phi(n)})^k = M$$

# Final Review
Majority in class exercise
## ICE4 RSA part:
1. Euler’s totient function
2. Euclidean algorithm, get gcd
3. Bizout's algorithm top down  
use the relationship in Euclidean algorithm's steps, bottom up  
other possible questions: the modification? multiplicative inverse of some number
1. RSA key gen, encrypt & decrypt
2. restriction of input smaller than n
## ICE3 AES part:
1. Special case multiply by 2, left shift, if most significant bit is 1, XOR with 0x1B
2. Polynomial multiplication
> Double check result with alternative shift and xor method  

1. AES Tranformation - sequential operation, use result from previous transformation as input
> mult 0x02 left shift, mult 0x03 = mult 0x02 & XOR orignal  
> special case XOR 0x1B

## ICE2 Network Security
Understand slides & lab then solve question
Understand attacks
1. Packages are visible in LAN from lab experience
2. Elaborate step to step how to carry out the attack
3. Application Level user control (symmetric & asymmetric), end to end, safe from all other parties
4. Infrastructure Level, router to router, example intercontiental companies communication between headquarters

## ICE1 Symmetric & Asymmetric Cryptosystem
1. Confidentiality 
2. Authentication
3. Certificate